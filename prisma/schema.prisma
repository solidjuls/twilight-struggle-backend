generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["typedSql"]
  binaryTargets   = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "foreignKeys"
}

model cities {
  id         BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  name       String  @db.VarChar(50)
  timeZoneId String? @db.VarChar(40)
  users      users[]
}

model countries {
  id           BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  tld_code     String  @db.VarChar(255)
  country_name String  @db.VarChar(255)
  users        users[]

  @@index([country_name], map: "countries_country_name_index")
}

model game_results {
  id                                       BigInt            @id @default(autoincrement()) @db.UnsignedBigInt
  created_at                               DateTime?         @db.Timestamp(0)
  updated_at                               DateTime?         @db.Timestamp(0)
  usa_player_id                            BigInt            @db.UnsignedBigInt
  ussr_player_id                           BigInt            @db.UnsignedBigInt
  game_code                                String            @db.VarChar(255)
  reported_at                              DateTime          @db.Timestamp(0)
  game_winner                              String            @db.VarChar(255)
  end_turn                                 Int?              @db.UnsignedInt
  end_mode                                 String?           @db.VarChar(255)
  game_date                                DateTime          @db.Timestamp(0)
  video1                                   String?           @db.VarChar(255)
  reporter_id                              BigInt?           @db.UnsignedBigInt
  usa_previous_rating                      Int               @default(0)
  ussr_previous_rating                     Int               @default(0)
  tournament_id                            Int?
  users_game_results_reporter_idTousers    users?            @relation("game_results_reporter_idTousers", fields: [reporter_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "game_results_reporter_id_foreign")
  tournaments                              tournaments?      @relation(fields: [tournament_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "game_results_tournament_id_foreign")
  users_game_results_usa_player_idTousers  users             @relation("game_results_usa_player_idTousers", fields: [usa_player_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "game_results_usa_player_id_foreign")
  users_game_results_ussr_player_idTousers users             @relation("game_results_ussr_player_idTousers", fields: [ussr_player_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "game_results_ussr_player_id_foreign")
  ratings_history                          ratings_history[]
  schedule                                 schedule?

  @@index([end_mode], map: "game_results_end_mode_index")
  @@index([end_turn], map: "game_results_end_turn_index")
  @@index([game_date], map: "game_results_game_date_index")
  @@index([tournament_id], map: "game_results_tournament_id_index")
  @@index([reported_at], map: "game_results_reported_at_index")
  @@index([reporter_id], map: "game_results_reporter_id_foreign")
  @@index([usa_player_id], map: "game_results_usa_player_id_foreign")
  @@index([ussr_player_id], map: "game_results_ussr_player_id_foreign")
}

model game_results_modified_log {
  id             BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  created_at     DateTime? @db.Timestamp(0)
  updated_at     DateTime? @db.Timestamp(0)
  gameId         BigInt    @db.UnsignedBigInt
  usa_player_id  BigInt    @db.UnsignedBigInt
  ussr_player_id BigInt    @db.UnsignedBigInt
  game_type      Int?
  game_code      String    @db.VarChar(255)
  reported_at    DateTime  @db.Timestamp(0)
  game_winner    String    @db.VarChar(255)
  end_turn       Int?      @db.UnsignedInt
  end_mode       String?   @db.VarChar(255)
  game_date      DateTime  @db.Timestamp(0)
  video1         String?   @db.VarChar(255)
  reporter_id    String?   @db.VarChar(255)
}

model ratings_history {
  id             BigInt       @id @default(autoincrement()) @db.UnsignedBigInt
  created_at     DateTime?    @db.Timestamp(0)
  updated_at     DateTime?    @db.Timestamp(0)
  player_id      BigInt       @db.UnsignedBigInt
  rating         Int          @default(0)
  game_code      String       @db.VarChar(255)
  game_result_id BigInt       @db.UnsignedBigInt
  total_games    Int          @default(0)
  friendly_games Int          @default(0)
  usa_victories  Int          @default(0)
  usa_losses     Int          @default(0)
  usa_ties       Int          @default(0)
  ussr_victories Int          @default(0)
  ussr_losses    Int          @default(0)
  ussr_ties      Int          @default(0)
  game_results   game_results @relation(fields: [game_result_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ratings_history_game_result_id_foreign")
  users          users        @relation(fields: [player_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ratings_history_player_id_foreign")

  @@unique([player_id, game_result_id], map: "ratings_history_player_id_game_result_id_unique")
  @@index([game_result_id], map: "ratings_history_game_result_id_foreign")
  @@index([player_id, created_at], map: "ratings_history_player_id_created_at_index")
}

model users {
  id                                              BigInt                    @id @default(autoincrement()) @db.UnsignedBigInt
  email                                           String?                   @unique(map: "UQ_users_email") @db.VarChar(255)
  password                                        String?                   @db.VarChar(255)
  created_at                                      DateTime?                 @db.Timestamp(0)
  updated_at                                      DateTime?                 @db.Timestamp(0)
  country_id                                      BigInt?                   @db.UnsignedBigInt
  first_name                                      String?                   @db.VarChar(255)
  last_name                                       String?                   @db.VarChar(255)
  last_login_at                                   DateTime?                 @db.Timestamp(0)
  city_id                                         BigInt?                   @db.UnsignedBigInt
  phone_number                                    String?                   @db.VarChar(20)
  preferred_gaming_platform                       String?                   @db.VarChar(50)
  preferred_game_duration                         String?                   @db.VarChar(50)
  timezone_id                                     String?                   @db.VarChar(40)
  role_id                                         Int?
  playdek_name                                    String?                   @db.VarChar(255)
  email_verified_at                               String?                   @db.VarChar(50)
  game_results_game_results_reporter_idTousers    game_results[]            @relation("game_results_reporter_idTousers")
  game_results_game_results_usa_player_idTousers  game_results[]            @relation("game_results_usa_player_idTousers")
  game_results_game_results_ussr_player_idTousers game_results[]            @relation("game_results_ussr_player_idTousers")
  ratings_history                                 ratings_history[]
  schedule_schedule_usa_player_idTousers          schedule[]                @relation("schedule_usa_player_idTousers")
  schedule_schedule_ussr_player_idTousers         schedule[]                @relation("schedule_ussr_player_idTousers")
  standing_players                                standing_players[]
  tournament_admins                               tournament_admins[]
  tournament_registration                         tournament_registration[]
  tournament_waitlist                             tournament_waitlist[]
  cities                                          cities?                   @relation(fields: [city_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "users_city_id_foreign")
  countries                                       countries?                @relation(fields: [country_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "users_country_id_foreign")

  @@index([city_id], map: "users_city_id_foreign")
  @@index([country_id], map: "users_country_id_foreign")
  @@index([first_name], map: "users_first_name_index")
  @@index([last_name], map: "users_last_name_index")
}

model TournamentStatus {
  id          Int           @id @default(autoincrement())
  status_name String        @unique(map: "status_name") @db.VarChar(100)
  tournaments tournaments[]
}

model tournament_registration {
  id           Int                             @id @default(autoincrement())
  tournamentId Int
  userId       BigInt                          @db.UnsignedBigInt
  status       tournament_registration_status? @default(pending)
  created_at   DateTime?                       @default(now()) @db.Timestamp(0)
  updated_at   DateTime?                       @default(now()) @db.Timestamp(0)
  tournaments  tournaments                     @relation(fields: [tournamentId], references: [id], onDelete: Cascade, map: "fk_tournament")
  users        users                           @relation(fields: [userId], references: [id], onDelete: Cascade, map: "fk_tournament_registration_user")

  @@index([tournamentId], map: "fk_tournament")
  @@index([userId], map: "fk_tournament_registration_user")
}

model tournament_waitlist {
  id           Int             @id @default(autoincrement())
  tournamentId Int
  userId       BigInt          @db.UnsignedBigInt
  position     Int?            @db.UnsignedInt
  status       waitlist_status @default(waiting)
  created_at   DateTime?       @default(now()) @db.Timestamp(0)
  updated_at   DateTime?       @default(now()) @db.Timestamp(0)
  tournaments  tournaments     @relation(fields: [tournamentId], references: [id], onDelete: Cascade, map: "fk_tournament_waitlist")
  users        users           @relation(fields: [userId], references: [id], onDelete: Cascade, map: "fk_tournament_waitlist_user")

  @@unique([tournamentId, userId], map: "unique_tournament_user_waitlist")
  @@index([tournamentId], map: "fk_tournament_waitlist")
  @@index([userId], map: "fk_tournament_waitlist_user")
  @@index([tournamentId, position], map: "tournament_waitlist_position_index")
}

model tournaments {
  id                      Int                       @id @default(autoincrement())
  tournament_name         String                    @db.VarChar(255)
  status_id               Int
  created_at              DateTime?                 @default(now()) @db.Timestamp(0)
  updated_at              DateTime?                 @default(now()) @db.Timestamp(0)
  description             String?                   @db.VarChar(100)
  starting_date           DateTime?                 @db.Date
  waitlist                Boolean                   @default(false)
  game_results            game_results[]
  schedule                schedule[]
  standings               standings[]
  tournament_admins       tournament_admins[]
  tournament_registration tournament_registration[]
  tournament_waitlist     tournament_waitlist[]
  TournamentStatus        TournamentStatus          @relation(fields: [status_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tournaments_TournamentStatus_FK")

  @@index([status_id], map: "tournaments_TournamentStatus_FK")
}

model schedule {
  id                                   Int           @id @default(autoincrement())
  tournaments_id                       Int
  game_code                            String        @db.VarChar(100)
  usa_player_id                        BigInt?       @db.UnsignedBigInt
  ussr_player_id                       BigInt?       @db.UnsignedBigInt
  due_date                             DateTime      @db.Date
  game_results_id                      BigInt?       @unique(map: "unique_game_results_id") @db.UnsignedBigInt
  created_at                           DateTime?     @default(now()) @db.Timestamp(0)
  updated_at                           DateTime?     @default(now()) @db.Timestamp(0)
  tournaments                          tournaments   @relation(fields: [tournaments_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "schedule_ibfk_1")
  users_schedule_usa_player_idTousers  users?        @relation("schedule_usa_player_idTousers", fields: [usa_player_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "schedule_ibfk_2")
  users_schedule_ussr_player_idTousers users?        @relation("schedule_ussr_player_idTousers", fields: [ussr_player_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "schedule_ibfk_3")
  game_results                         game_results? @relation(fields: [game_results_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "schedule_ibfk_4")

  @@index([tournaments_id], map: "tournaments_id")
  @@index([usa_player_id], map: "usa_player_id")
  @@index([ussr_player_id], map: "ussr_player_id")
}

model tournament_admins {
  userId       BigInt      @db.UnsignedBigInt
  tournamentId Int
  users        users       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "tournament_admins_ibfk_1")
  tournaments  tournaments @relation(fields: [tournamentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "tournament_admins_ibfk_2")

  @@id([userId, tournamentId])
  @@index([tournamentId], map: "tournamentId")
}

model standing_players {
  standing_id Int
  user_id     BigInt    @db.UnsignedBigInt
  standings   standings @relation(fields: [standing_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_standing_players_standing")
  users       users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_standing_players_user")

  @@id([standing_id, user_id])
  @@index([user_id], map: "fk_standing_players_user")
}

model standings {
  id               Int                @id @default(autoincrement())
  tournaments_id   Int
  standing_name    String             @db.VarChar(255)
  secondary_name   String?            @db.VarChar(255)
  standing_players standing_players[]
  tournaments      tournaments        @relation(fields: [tournaments_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "standings_ibfk_1")

  @@index([tournaments_id], map: "tournaments_id")
}

enum tournament_registration_status {
  accepted
  rejected
  pending
  waiting
  forfeited
}

enum waitlist_status {
  waiting
  promoted
  removed
}
